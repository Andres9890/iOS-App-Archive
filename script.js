        // App data with download URLs and categories
        const apps = [
            {
                id: "escape-if-you-can",
                title: "Escape If You Can",
                developer: "mobigrow",
                featuredDescription: "Try to find your way through many floors on this classic Available Now!",
                description: "Can You Escape - Deluxe - Out Now!\nAdvance to the next floor by solving the puzzles!\nYou can pick certain items up and use them from your inventory.\nKeep the Escape If You Can app, so we can notify you of new levels.\n9 floors available at the moment!\nSmartphone puzzles! Addicting mini puzzles!\nGorgeous graphics and different themed floors!\nConstant updates of New Floors!\nit's FREE!",
                versions: {
                    archived: [
                        { version: "1.3.3", url: "https://archive.org/download/com.dozengames.floorsescape-ios4.3-clutch-2.0.4_202412/com.dozengames.FloorsEscape-iOS4.3-%28Clutch-2.0.4%29.ipa" }
                    ],
                    unarchived: ["1.0.0", "1.1.0", "1.2.0", "1.3.0", "1.3.1", "1.3.2"]
                },
                compatibility: "iOS 4.3 and Later",
                icon: "app-icon/escape-if-you-can.jpg",
                featured: true,
                categories: ["Puzzle", "Adventure"]
            },
            {
                id: "jelly-car-3-lite",
                title: "JellyCar 3 Lite",
                developer: "Disney",
                featuredDescription: "This Disney Classic Now on iOS App Archive",
                description: "The wobbly, bouncy, jelly-licious driving game is back!\nDrive through squishy worlds with new vehicles and obstacles.\nUnique jelly physics make every drive different.\nColorful, imaginative levels to explore.\nSimple controls with challenging gameplay.\nPerfect for quick gaming sessions.",
                versions: {
                    archived: [
                        { version: "1.0", url: "https://archive.org/download/com.disney.jellycar3lite-ios3.1.3-clutch-2.0.4/JellyCar%203%20Lite%201.0%20%283998555%29.ipa" },
                        { version: "1.0.1", url: "https://archive.org/download/com.disney.jellycar3lite-ios3.1.3-clutch-2.0.4/JellyCar%203%20Lite%201.0.1%20%284155986%29.ipa" }
                    ],
                    unarchived: []
                },
                compatibility: "iPhoneOS 3.1.3 and Later",
                icon: "app-icon/jelly-car-3-lite.png",
                featured: true,
                categories: ["Racing", "Action"]
            },
            {
                id: "disney-gift-card",
                title: "Disney Gift Card",
                developer: "Disney",
                featuredDescription: "Enjoy the gift of Disney Gift Card",
                description: "Check your Disney Gift Card balance anytime.\nSecure and easy to use.\nManage multiple gift cards in one place.\nView transaction history.\nRedeem new gift cards with your camera.\nOfficial Disney app with trusted security.",
                versions: {
                    archived: [
                        { version: "1.0", url: "https://archive.org/download/com.disney.disneygiftcard-ios3.1.2-clutch-2.0.4/com.disney.DisneyGiftCard-iOS3.1.2-%28Clutch-2.0.4%29.ipa" }
                    ],
                    unarchived: []
                },
                compatibility: "iPhoneOS 3.1.2 and Later",
                icon: "app-icon/disney-gift-card.png",
                featured: true,
                categories: ["Finance"]
            },
            {
                id: "flappy-bird",
                title: "Flappy Bird",
                developer: "dotGears",
                featuredDescription: "The Classic Bird Jumper is Back",
                description: "The infamous challenging flying game!\nTap to keep the bird flying through pipes.\nSimple controls, extremely difficult to master.\nCompete with friends for high scores.\nMinimalist pixel art style.\nAddictive one-more-try gameplay.",
                versions: {
                    archived: [
                        { version: "1.0", url: "https://archive.org/download/flappy-bird-v-1.3_202412/Flappy%20Bird%20v1.0.ipa" },
                        { version: "1.1", url: "https://archive.org/download/flappy-bird-v-1.3_202412/Flappy%20Bird%20v1.1.ipa" },
                        { version: "1.2", url: "https://archive.org/download/flappy-bird-v-1.3_202412/Flappy%20Bird%20v1.2.ipa" },
                        { version: "1.3", url: "https://archive.org/download/flappy-bird-v-1.3_202412/Flappy%20Bird%20v1.3.ipa" }
                    ],
                    unarchived: []
                },
                compatibility: "iOS 6.0 and Later",
                icon: "app-icon/flappy-bird.png",
                featured: true,
                categories: ["Action", "Entertainment"]
            },
            {
                id: "lightbike-online",
                title: "LightBike Online",
                developer: "ArtyPig Entertainment",
                featuredDescription: "Tron-inspired lightcycle battles",
                description: "Experience the classic Tron lightcycle battle in this multiplayer online game!\nCompete against players worldwide in real-time battles.\nCustomize your lightbike with different colors and trails.\nClimb the global leaderboards and prove your skills.\nSimple controls with intense competitive gameplay.",
                versions: {
                    archived: [
                        { version: "1.1.1", url: "https://archive.org/download/light-bike-online-v-1.2.8-artypig-78/LightBike_v1.1.1_os22.ipa" },
                        { version: "1.2.5", url: "https://archive.org/download/light-bike-online-v-1.2.8-artypig-78/LightBike%201.2.5.ipa" },
                        { version: "1.2.6", url: "https://archive.org/download/light-bike-online-v-1.2.8-artypig-78/LightBike.v1.2.6.iPhone%20C4iD.ipa" },
                        { version: "1.2.8", url: "https://archive.org/download/light-bike-online-v-1.2.8-artypig-78/LightBikeOnline%20v1.2.8%20artypig78.ipa" }
                    ],
                    unarchived: ["1.0", "1.1", "1.2", "1.2.1", "1.2.2", "1.2.3", "1.2.4", "1.2.7"]
                },
                compatibility: "iOS 4.3 and Later",
                icon: "app-icon/lightbike-online.jpeg",
                featured: true,
                categories: ["Racing", "Action"]
            },
            {
                id: "jelly-car-2",
                title: "Jelly Car 2",
                developer: "Disney",
                featuredDescription: "New Levels Now Available, Download Now!",
                description: "The sequel to the original jelly physics driving game!\nNew vehicles with unique jelly properties.\nMore challenging levels and obstacles.\nColorful, squishy environments to explore.\nSimple one-touch controls.\nFun for all ages with surprising depth.",
                versions: {
                    archived: [
                        { version: "1.0.0", url: "https://archive.org/download/jelly-car-2-1.2.2/JellyCar%202%201.0.0.ipa" },
                        { version: "1.0.1", url: "https://archive.org/download/jelly-car-2-1.2.2/JellyCar%202%201.0.1.ipa" },
                        { version: "1.1", url: "https://archive.org/download/jelly-car-2-1.2.2/JellyCar%202%201.1.ipa" },
                        { version: "1.2", url: "https://archive.org/download/jelly-car-2-1.2.2/JellyCar%202%201.2.ipa" },
                        { version: "1.2.1", url: "https://archive.org/download/jelly-car-2-1.2.2/JellyCar%202%201.2.1.ipa" },
                        { version: "1.2.2", url: "https://archive.org/download/jelly-car-2-1.2.2/JellyCar%202%201.2.2.ipa" }
                    ],
                    unarchived: []
                },
                compatibility: "iOS 4.0 and Later",
                icon: "app-icon/jelly-car-2.jpeg",
                featured: false,
                categories: ["Racing", "Action"]
            },
            {
                id: "godzilla-strike-zone",
                title: "Godzilla: Strike Zone",
                developer: "Warner Bros",
                featuredDescription: "Join the squadron and face GODZILLA! Now archived.",
                description: "Join a squadron of military heroes on a dangerous mission to face the ultimate force of nature: GODZILLA.\nExperience the breathtaking high-altitude sky jump from the movie as you air-drop into a devastated San Francisco and embark on a series of first-person rescue missions to evacuate survivors before it's too late.\nYour courage has never been more needed than it is today.\nSee GODZILLA in theaters May 16.",
                versions: {
                    archived: [
                        { version: "1.1.0", url: "https://archive.org/download/godzilla-strike-zone-com.wb.godzilla.strikezone-5433-v-1.1.0-i-os-5.0/Godzilla%20Strike%20Zone-%28com.wb.godzilla.strikezone%29-5433-%20%28V1.1.0%29%20%28iOS_5.0%29-.ipa" }
                    ],
                    unarchived: []
                },
                compatibility: "iOS 5.0 and Later",
                icon: "app-icon/godzilla-strike-zone.png",
                featured: false,
                categories: ["Games", "Entertainment"]
            },
            {
                id: "buster-bash",
                title: "Buster Bash",
                developer: "Ground Up Logic",
                featuredDescription: "Official Mobile Game of All-Star catcher Buster Posey.",
                description: "BUSTER BASH -- Official Mobile Game of All-Star catcher Buster Posey.\n\nFollow in Buster's footsteps as you begin in the backyard of Leesburg, Georgia and move up levels to eventually join the elite ranks of the Big Leagues.\nYou get 10 baseballs per round to hit as many homers as possible. Players earn sunflower seeds to buy equipment and power-ups to improve hitting by knocking them out of the sky or through in-app purchases.\n\nSwipe the screen to knock pitches over the barn or outfield fence. You'll hit tennis balls and wiffle balls as a kid, but as you move up, it's all hardballs, and the pitchers get tougher!\n\nFeatures include:\n\n+ original music from Battery Amp\n\n+ equipment upgrades through the UNDER ARMOUR store\n\n+ five levels: Backyard in Leesburg, the TOYOTA Youth Championship, the UNDER ARMOUR All-American Game, College Playoffs, and the Big Leagues\n\nFollow on Twitter @BusterBash or Like us on Facebook for official Buster Bash giveaways.",
                versions: {
                    archived: [
                        { version: "2.12", url: "https://archive.org/download/com.grounduplogic.bb-ios7.0-clutch-2.0.4_202505/com.grounduplogic.bb-iOS7.0-%28Clutch-2.0.4%29.ipa" }
                    ],
                    unarchived: []
                },
                compatibility: "iOS 7.0 and Later",
                icon: "app-icon/buster-bash.png",
                featured: false,
                categories: ["Games", "Sports", "Casual"]
            },
            {
                id: "beer-bounce",
                title: "Beer Bounce",
                developer: "Developer Unknown",
                featuredDescription: "Unknown",
                description: "no description found",
                versions: {
                    archived: [
                        { version: "1.0.0", url: "https://archive.org/download/beer-bounce-quarters-1.0/Beer%20Bounce%20%28Quarters%29%201.0.ipa" }
                    ],
                    unarchived: []
                },
                compatibility: "iPhoneOS 2.0 and Later",
                icon: "app-icon/beer-bounce.png",
                featured: false,
                categories: ["Entertainment", "Beer"]
            },
            {
                id: "beer-ratings-guide",
                title: "Beer Ratings Guide",
                developer: "Nirvino",
                featuredDescription: "100,000+ bottles of beer at your fingertips.",
                description: "Put 100,000+ bottles of beer at your fingertips.\nStuck in a restaurant staring blankly at the menu? ...or perhaps at the grocery store doing 'Eeny, meeny, miny, moe' – believe us, we've been there. Nirvino's Beer Ratings Guide iPhone application helps you choose that great glass of beer when you need it most! Search our 100,000 beer database by name, price, style, food pairing, flavor profile, region, producer, and designation.\n\nForgot last night's beer?\nKeep track of the great (and not so great) beer you discover with our Beer Ratings Guide. No login or lengthy forms to fill out. Rate a beer with just one simple tap and it automatically saves to your personal ratings list. It's like your little black book for beer!\n\nAccess the most important information you need to make a quick and easy purchasing decision:\n\n- Beer Name\n- Ratings\n- Bottle Shot\n- Pairing Recommendations\n- Flavor Profile\n- Price",
                versions: {
                    archived: [
                        { version: "1.21", url: "https://archive.org/download/beer-ratings-com.nirvino.-beer-ratings-guide-v-1.21-i-os-3.1/Beer%20Ratings-%28com.nirvino.BeerRatingsGuide%29%20%28V1.21%29%20%28iOS_3.1%29.ipa" }
                    ],
                    unarchived: []
                },
                compatibility: "iPhoneOS 3.1 and Later",
                icon: "app-icon/beer-ratings-guide.png",
                featured: false,
                categories: ["Lifestyle", "Food & Drink", "Beer"]
            },
            {
                id: "beer-goggles-by-hive-mind",
                title: "Beer Goggles by Hive Mind",
                developer: "Hive Mind LLC",
                featuredDescription: "Test your judgment with Beer Goggles!",
                description: "Ever wondered what that great looking girl at the bar really looks like? Take our test to see if your eyes are giving your brain the right information! Life is too short for regrets, and 'Beer Goggles by Hive Mind' will help you dodge those uncomfortable mornings, awkward walks of shame, and trips to the emergency room!\n\nRate a set of three carefully selected 3D models and 'Beer Goggles by Hive Mind' will use a unique algorithm that will determine how closely you matched the ideal ratings and determine how badly your judgment is impaired.\n\nFor entertainment purposes only!\n\n\"I checked this app before I left the bar with a girl and lucky for me it told me to take a closer look... Thanks guys!\"\n\n\"'Beer Goggles by Hive Mind' saved me!!! I was about to make the biggest mistake of my life.\"\n\n\"GAAAAAAAH!! You should put a warning on some of your pictures!\"\n\nVersion History\n1.1 - Minor Bug Fix\n1.2 - Improved User Interface\n- Increased Model Display Time\n- Added New Models and Quotes\n1.3 - Code Optimization\n1.4 - New Models, Bug Fixes\n2.0 - iOS4 Ready",
                versions: {
                    archived: [
                        { version: "1.3", url: "https://archive.org/download/beer-goggles-by-hive-mind-1.3/Beer%20Goggles%20by%20Hive%20Mind%201.3.ipa" }
                    ],
                    unarchived: []
                },
                compatibility: "iPhoneOS 2.2.1 and Later",
                icon: "app-icon/beer-goggles-by-hive-mind.png",
                featured: false,
                categories: ["Games", "Entertainment", "Lifestyle", "Beer"]
            },
            {
                id: "beer-pong-challenge",
                title: "Beer Pong Challenge",
                developer: "Jeremy Lazarus",
                featuredDescription: "Play Beer Pong on your iPhone!",
                description: "Play Beer Pong on the iPhone! Challenge a friend with a classic 6 or 10 cup table, or compete against your own high scores in the single-player arcade game mode. Decorate the game's garage each time you achieve a new high score by snapping a photo of yourself!\n\n• New Officially licensed update with BOMBED Beer Pong and www.GetBOMBED.com – the world's #1 brand in beer pong.\n\n• Game Graphics now feature the Official BOMBED Beer Pong tables, balls, posters and more",
                versions: {
                    archived: [
                        { version: "1.0.7", url: "https://archive.org/download/com.superexperiment.beerpong-v-1.0.7-i-os-2.2-clutch-2.0.4/com.superexperiment.beerpong%20%28V1.0.7%29%20-iOS2.2-%28Clutch-2.0.4%29.ipa" }
                    ],
                    unarchived: []
                },
                compatibility: "iPhoneOS 2.2 and Later",
                icon: "app-icon/beer-pong-challenge.png",
                featured: false,
                categories: ["Games", "Entertainment", "Casual", "Sports", "Beer"]
            },
            {
                id: "beerduel",
                title: "BeerDuel",
                developer: "iMouse",
                featuredDescription: "A game of Cowboys and beer cups!",
                description: "It's a game of Cowboys.\nYou can play with your friends.\nSlide three cups with draft beer on a table as far as you can.\nThe score you get depends on where the cups stop.\n1) Move the cup to appropriate starting position.\n2) Slide it!\nTips: you can also hit other cups to change the situation",
                versions: {
                    archived: [
                        { version: "1.0", url: "https://archive.org/download/beer-duel-i-mouse.-beer-duel-v-1.0-i-os-2.1/BeerDuel-%28iMouse.BeerDuel%29%28V1.0%29%20%28iOS_2.1%29.ipa" }
                    ],
                    unarchived: ["1.1"]
                },
                compatibility: "iPhoneOS 2.1 and Later",
                icon: "app-icon/beerduel.png",
                featured: false,
                categories: ["Games", "Entertainment", "Action", "Simulation", "Beer"]
            }
        ];

        // DOM Elements
        const carouselContainer = document.getElementById('carouselContainer');
        const carousel = document.getElementById('carousel');
        const carouselNav = document.getElementById('carouselNav');
        const searchResults = document.getElementById('searchResults');
        const searchContainer = document.getElementById('searchContainer');
        const searchInput = document.getElementById('searchInput');
        const cancelSearch = document.getElementById('cancelSearch');
        const tabs = document.querySelectorAll('.tab');
        const modalContainer = document.getElementById('modalContainer');
        
        // Tab content areas
        const tabContents = {
            featured: document.getElementById('featuredContent'),
            categories: document.getElementById('categoriesContent'),
            genius: document.getElementById('geniusContent'),
            search: document.getElementById('searchContent'),
            updates: document.getElementById('updatesContent')
        };
        
        // Carousel state
        let currentIndex = 0;
        let autoSlideInterval;
        let touchStartX = 0;
        let touchEndX = 0;
        
        // Initialize carousel
        function initCarousel() {
            // Clear existing items
            carousel.innerHTML = '';
            carouselNav.innerHTML = '';
            
            // Filter only featured apps for the carousel
            const featuredApps = apps.filter(app => app.featured);
            
            // Create carousel items
            featuredApps.forEach((app, index) => {
                const carouselItem = document.createElement('div');
                carouselItem.className = 'carousel-item';
                carouselItem.dataset.index = index;
                
                carouselItem.innerHTML = `
                    <div class="app-card">
                        <div class="app-icon-container">
                            <div class="app-icon">
                                ${app.icon ? `<img src="${app.icon}" alt="${app.title}" loading="lazy" onerror="this.onerror=null;this.parentElement.innerHTML='<i class=\\'fas fa-mobile-alt\\'></i>'">` : 
                                '<i class="fas fa-mobile-alt"></i>'}
                            </div>
                        </div>
                        <h3 class="app-title">${app.title}</h3>
                        <div class="app-description">${app.featuredDescription}</div>
                        <button class="card-button" data-app-id="${app.id}">View Details</button>
                    </div>
                `;
                
                carousel.appendChild(carouselItem);
                
                // Create navigation dot
                const navDot = document.createElement('div');
                navDot.className = 'nav-dot';
                navDot.dataset.index = index;
                navDot.addEventListener('click', () => goToSlide(index));
                carouselNav.appendChild(navDot);
            });
            
            // Set initial slide
            updateCarousel();
            
            // Start auto slide
            startAutoSlide();
            
            // Add swipe functionality
            setupSwipe();
            
            // Add event listener to carousel buttons
            document.querySelectorAll('.app-card .card-button').forEach(button => {
                button.addEventListener('click', function() {
                    const appId = this.getAttribute('data-app-id');
                    setUrlParam('app', appId);
                    document.getElementById(`${appId}Modal`).classList.add('active');
                    document.body.style.overflow = 'hidden';
                });
            });
        }
        
        // Update carousel position
        function updateCarousel() {
            const items = document.querySelectorAll('.carousel-item');
            const dots = document.querySelectorAll('.nav-dot');
            const itemCount = items.length;
            
            items.forEach((item, index) => {
                item.classList.remove('active', 'prev', 'next');
                
                if (index === currentIndex) {
                    item.classList.add('active');
                } else if (index === (currentIndex - 1 + itemCount) % itemCount) {
                    item.classList.add('prev');
                } else if (index === (currentIndex + 1) % itemCount) {
                    item.classList.add('next');
                }
            });
            
            dots.forEach((dot, index) => {
                dot.classList.toggle('active', index === currentIndex);
            });
        }
        
        // Go to specific slide
        function goToSlide(index) {
            currentIndex = index;
            updateCarousel();
            resetAutoSlide();
        }
        
        // Next slide
        function nextSlide() {
            const items = document.querySelectorAll('.carousel-item');
            currentIndex = (currentIndex + 1) % items.length;
            updateCarousel();
        }
        
        // Previous slide
        function prevSlide() {
            const items = document.querySelectorAll('.carousel-item');
            currentIndex = (currentIndex - 1 + items.length) % items.length;
            updateCarousel();
        }
        
        // Start auto slide
        function startAutoSlide() {
            autoSlideInterval = setInterval(nextSlide, 8000);
        }
        
        // Reset auto slide timer
        function resetAutoSlide() {
            clearInterval(autoSlideInterval);
            startAutoSlide();
        }
        
        // Setup swipe functionality
        function setupSwipe() {
            carouselContainer.addEventListener('touchstart', e => {
                touchStartX = e.changedTouches[0].screenX;
            }, false);
            
            carouselContainer.addEventListener('touchend', e => {
                touchEndX = e.changedTouches[0].screenX;
                handleSwipe();
            }, false);
            
            function handleSwipe() {
                if (touchEndX < touchStartX - 50) {
                    nextSlide();
                }
                
                if (touchEndX > touchStartX + 50) {
                    prevSlide();
                }
                
                resetAutoSlide();
            }
        }
        
        // Render search results
        function renderSearchResults(filteredApps = []) {
            searchResults.innerHTML = '';
            
            if (filteredApps.length === 0) {
                searchResults.innerHTML = '<p style="text-align: center; grid-column: 1/-1; padding: 20px; color: #aaa;">No apps found. Try a different search term.</p>';
                return;
            }
            
            filteredApps.forEach(app => {
                const appCard = document.createElement('div');
                appCard.className = 'app-card-grid';
                
                appCard.innerHTML = `
                    <div class="card-icon">
                        ${app.icon ? `<img src="${app.icon}" alt="${app.title}" loading="lazy" onerror="this.onerror=null;this.parentElement.innerHTML='<i class=\\'fas fa-mobile-alt\\'></i>'">` : 
                        '<i class="fas fa-mobile-alt"></i>'}
                    </div>
                    <div class="card-name">${app.title}</div>
                    <div class="card-developer">${app.developer}</div>
                    <button class="card-button" data-app-id="${app.id}">View Details</button>
                `;
                
                searchResults.appendChild(appCard);
            });
            
            // Add event listeners to buttons
            document.querySelectorAll('.card-button').forEach(button => {
                button.addEventListener('click', function() {
                    const appId = this.getAttribute('data-app-id');
                    setUrlParam('app', appId);
                    document.getElementById(`${appId}Modal`).classList.add('active');
                    document.body.style.overflow = 'hidden';
                });
            });
        }
        
        // Create modals
        function createModals() {
            modalContainer.innerHTML = '';
            
            apps.forEach(app => {
                // Create version list items
                let versionItems = '';
                
                // Add archived versions if they exist
                if (app.versions.archived.length > 0) {
                    versionItems += `
                        <div class="version-group">
                            <h4>Archived Versions</h4>
                            <ul class="version-list">
                                ${app.versions.archived.map(v => {
                                    return `<li>
                                        <span>${v.version}</span>
                                        <a href="${v.url}" download class="download-button">
                                            <i class="fas fa-download"></i> Download IPA
                                        </a>
                                    </li>`;
                                }).join('')}
                            </ul>
                        </div>
                    `;
                }
                
                // Add unarchived versions if they exist
                if (app.versions.unarchived.length > 0) {
                    versionItems += `
                        <div class="version-group">
                            <h4 class="unarchived-label">Unarchived Versions</h4>
                            <ul class="version-list">
                                ${app.versions.unarchived.map(v => `<li>${v}</li>`).join('')}
                            </ul>
                        </div>
                    `;
                }
                
                // Create category tags
                const categoryTags = app.categories.map(cat => 
                    `<span class="category-tag">${cat}</span>`
                ).join('');
                
                const modal = document.createElement('div');
                modal.className = 'modal-overlay';
                modal.id = `${app.id}Modal`;
                
                modal.innerHTML = `
                    <div class="modal-content">
                        <button class="close-modal">&times;</button>
                        <div class="modal-header">
                            <div class="modal-icon">
                                ${app.icon ? `<img src="${app.icon}" alt="${app.title}" loading="lazy" onerror="this.onerror=null;this.parentElement.innerHTML='<i class=\\'fas fa-mobile-alt\\'></i>'">` : 
                                '<i class="fas fa-mobile-alt"></i>'}
                            </div>
                            <div>
                                <h2 class="modal-title">${app.title}</h2>
                                <p class="modal-developer">${app.developer}</p>
                                <div class="modal-categories">
                                    ${categoryTags}
                                </div>
                            </div>
                        </div>
                        
                        <div class="modal-section">
                            <h3><i class="fas fa-mobile-alt"></i> Compatibility</h3>
                            <p class="compatibility-text">${app.compatibility}</p>
                        </div>
                        
                        <div class="modal-section">
                            <h3><i class="fas fa-align-left"></i> App Store Description</h3>
                            ${app.description.split('\n').map(p => `<p>${p}</p>`).join('')}
                        </div>
                        
                        <div class="modal-section">
                            <h3><i class="fas fa-code-branch"></i> Version History</h3>
                            <div class="versions-scroll-container">
                                <div class="versions-container">
                                    ${versionItems}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                modalContainer.appendChild(modal);
            });
            
            // Add modal close handlers
            document.querySelectorAll('.close-modal').forEach(btn => {
                btn.addEventListener('click', function() {
                    this.closest('.modal-overlay').classList.remove('active');
                    document.body.style.overflow = 'auto';
                    setUrlParam('app', '');
                });
            });
            
            // Close modal when clicking outside
            document.querySelectorAll('.modal-overlay').forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        this.classList.remove('active');
                        document.body.style.overflow = 'auto';
                        setUrlParam('app', '');
                    }
                });
            });
            
            // Close modal with Escape key
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    document.querySelectorAll('.modal-overlay.active').forEach(modal => {
                        modal.classList.remove('active');
                        document.body.style.overflow = 'auto';
                        setUrlParam('app', '');
                    });
                }
            });
        }
        
        // Tab switching
        tabs.forEach(tab => {
            tab.addEventListener('click', function() {
                const tabName = this.getAttribute('data-tab');
                
                // Update active tab
                tabs.forEach(t => t.classList.remove('active'));
                this.classList.add('active');
                
                // Hide all tab content
                Object.values(tabContents).forEach(content => {
                    content.classList.remove('active');
                });
                
                // Show/hide views based on tab
                if (tabName === 'featured') {
                    carouselContainer.style.display = 'block';
                    searchContainer.style.display = 'none';
                    searchResults.classList.remove('active');
                    tabContents.featured.classList.add('active');
                } else if (tabName === 'search') {
                    carouselContainer.style.display = 'none';
                    searchContainer.style.display = 'block';
                    searchResults.classList.add('active');
                    tabContents.search.classList.add('active');
                    renderSearchResults(apps);
                } else {
                    // For categories, genius, updates
                    carouselContainer.style.display = 'none';
                    searchContainer.style.display = 'none';
                    searchResults.classList.remove('active');
                    tabContents[tabName].classList.add('active');
                }
            });
        });
        
        // Search functionality
        searchInput.addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            setUrlParam('query', searchTerm);
            if (searchTerm.length === 0) {
                renderSearchResults(apps);
                return;
            }
            let filteredApps;
            if (searchTerm.includes('developer:')) {
                const parts = searchTerm.split('developer:');
                const namePart = parts[0].trim();
                const devPart = parts[1].trim();
                filteredApps = apps.filter(app => {
                    const matchesDev = app.developer.toLowerCase().includes(devPart);
                    const matchesName = namePart ? app.title.toLowerCase().includes(namePart) : true;
                    return matchesDev && matchesName;
                });
            } else {
                filteredApps = apps.filter(app => 
                    app.title.toLowerCase().includes(searchTerm) || 
                    app.developer.toLowerCase().includes(searchTerm)
                );
            }
            renderSearchResults(filteredApps);
        });
        
        // Show cancel button when search input is focused
        searchInput.addEventListener('focus', function() {
            cancelSearch.style.display = 'block';
        });
        
        // Hide cancel button when search input is blurred
        searchInput.addEventListener('blur', function() {
            if (this.value === '') {
                cancelSearch.style.display = 'none';
            }
        });
        
        // Cancel search
        cancelSearch.addEventListener('click', function() {
            searchInput.value = '';
            searchInput.blur();
            this.style.display = 'none';
            setUrlParam('query', '');
            renderSearchResults(apps);
        });
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            initCarousel();
            createModals();
            
            // Add keyboard navigation
            document.addEventListener('keydown', function(e) {
                if (e.key === 'ArrowRight') {
                    nextSlide();
                } else if (e.key === 'ArrowLeft') {
                    prevSlide();
                }
            });
            
            // Activate featured tab content
            tabContents.featured.classList.add('active');
            
            const queryParam = getUrlParam('query');
            if (queryParam) {
                searchInput.value = queryParam;
                tabs.forEach(tab => {
                    if (tab.getAttribute('data-tab') === 'search') {
                        tab.click();
                    }
                });
                let filteredApps;
                if (queryParam.includes('developer:')) {
                    const parts = queryParam.split('developer:');
                    const namePart = parts[0].trim();
                    const devPart = parts[1].trim();
                    filteredApps = apps.filter(app => {
                        const matchesDev = app.developer.toLowerCase().includes(devPart);
                        const matchesName = namePart ? app.title.toLowerCase().includes(namePart) : true;
                        return matchesDev && matchesName;
                    });
                } else {
                    filteredApps = apps.filter(app => 
                        app.title.toLowerCase().includes(queryParam) || 
                        app.developer.toLowerCase().includes(queryParam)
                    );
                }
                renderSearchResults(filteredApps);
            }
            const appParam = getUrlParam('app');
            if (appParam) {
                const modal = document.getElementById(`${appParam}Modal`);
                if (modal) {
                    modal.classList.add('active');
                    document.body.style.overflow = 'hidden';
                } else {
                    setUrlParam('app', '');
                    setTimeout(() => {
                        alert('App ID not found, please try again later.');
                    }, 100);
                }
            }
        });

        function setUrlParam(key, value) {
            const params = new URLSearchParams(window.location.search);
            if (value && value.length > 0) {
                params.set(key, value);
            } else {
                params.delete(key);
            }
            const newUrl = window.location.pathname + (params.toString() ? '?' + params.toString() : '');
            window.history.replaceState({}, '', newUrl);
        }

        function getUrlParam(key) {
            const params = new URLSearchParams(window.location.search);
            return params.get(key);
        }